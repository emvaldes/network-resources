+ local configs_matching__script=configs-matching
+ targets_jobs_pid=()
+ declare -ga targets_jobs_pid
+ targets_jobs2ips_mapping=()
+ declare -gA targets_jobs2ips_mapping
+ for ip_address in "${target_listing[@]}"
+ local report_path=reports/192.168.0.100
+ local configs_objects=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.0.100.list
+ :
+ [[ -d reports/192.168.0.100 ]]
+ for ext in "${file_extensions[@]}"
+ find reports/192.168.0.100 -type f -name '*.cfg'
+ for ext in "${file_extensions[@]}"
+ find reports/192.168.0.100 -type f -name '*.conf'
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.0.100.list ]]
+ local target_config=targets/192.168.0.100.json
+ local configs_targets__console=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.0.100
+ local job_pid=68139
+ targets_jobs_pid+=("${job_pid}")
+ targets_jobs2ips_mapping["${job_pid}"]=192.168.0.100
+ for ip_address in "${target_listing[@]}"
+ local report_path=reports/192.168.1.10
+ local configs_objects=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.1.10.list
+ :
+ [[ -d reports/192.168.1.10 ]]
+ for ext in "${file_extensions[@]}"
+ find reports/192.168.1.10 -type f -name '*.cfg'
+ configs_targets --search=192.168.0.100 --source=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.0.100.list --target=targets/192.168.0.100.json --logger=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.0.100.console --verbose
+ for ext in "${file_extensions[@]}"
+ find reports/192.168.1.10 -type f -name '*.conf'
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.1.10.list ]]
+ local target_config=targets/192.168.1.10.json
+ local configs_targets__console=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.1.10
+ local job_pid=68148
+ targets_jobs_pid+=("${job_pid}")
+ targets_jobs2ips_mapping["${job_pid}"]=192.168.1.10
+ for ip_address in "${target_listing[@]}"
+ local report_path=reports/192.168.1.11
+ local configs_objects=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.1.11.list
+ :
+ [[ -d reports/192.168.1.11 ]]
+ for ext in "${file_extensions[@]}"
+ find reports/192.168.1.11 -type f -name '*.cfg'
+ configs_targets --search=192.168.1.10 --source=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.1.10.list --target=targets/192.168.1.10.json --logger=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.1.10.console --verbose
+ for ext in "${file_extensions[@]}"
+ find reports/192.168.1.11 -type f -name '*.conf'
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.1.11.list ]]
+ local target_config=targets/192.168.1.11.json
+ local configs_targets__console=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.1.11
+ local job_pid=68161
+ targets_jobs_pid+=("${job_pid}")
+ targets_jobs2ips_mapping["${job_pid}"]=192.168.1.11
+ for ip_address in "${target_listing[@]}"
+ local report_path=reports/192.168.2.12
+ local configs_objects=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.2.12.list
+ :
+ [[ -d reports/192.168.2.12 ]]
+ for ext in "${file_extensions[@]}"
+ configs_targets --search=192.168.1.11 --source=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.1.11.list --target=targets/192.168.1.11.json --logger=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.1.11.console --verbose
+ find reports/192.168.2.12 -type f -name '*.cfg'
+ for ext in "${file_extensions[@]}"
+ find reports/192.168.2.12 -type f -name '*.conf'
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.2.12.list ]]
+ local target_config=targets/192.168.2.12.json
+ local configs_targets__console=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.2.12
+ local job_pid=68180
+ targets_jobs_pid+=("${job_pid}")
+ targets_jobs2ips_mapping["${job_pid}"]=192.168.2.12
+ for ip_address in "${target_listing[@]}"
+ local report_path=reports/192.168.100.100
+ local configs_objects=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.100.100.list
+ :
+ [[ -d reports/192.168.100.100 ]]
+ for ext in "${file_extensions[@]}"
+ find reports/192.168.100.100 -type f -name '*.cfg'
+ configs_targets --search=192.168.2.12 --source=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.2.12.list --target=targets/192.168.2.12.json --logger=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.2.12.console --verbose
+ for ext in "${file_extensions[@]}"
+ find reports/192.168.100.100 -type f -name '*.conf'
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.100.100.list ]]
+ local target_config=targets/192.168.100.100.json
+ local configs_targets__console=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.100.100
+ local job_pid=68203
+ targets_jobs_pid+=("${job_pid}")
+ targets_jobs2ips_mapping["${job_pid}"]=192.168.100.100
+ for ip_address in "${target_listing[@]}"
+ local report_path=reports/198.51.100.75
+ local configs_objects=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.list
+ :
+ [[ -d reports/198.51.100.75 ]]
+ for ext in "${file_extensions[@]}"
+ find reports/198.51.100.75 -type f -name '*.cfg'
+ configs_targets --search=192.168.100.100 --source=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.100.100.list --target=targets/192.168.100.100.json --logger=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.100.100.console --verbose
+ for ext in "${file_extensions[@]}"
+ find reports/198.51.100.75 -type f -name '*.conf'
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.list ]]
+ local target_config=targets/198.51.100.75.json
+ local configs_targets__console=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75
+ local job_pid=68225
+ targets_jobs_pid+=("${job_pid}")
+ targets_jobs2ips_mapping["${job_pid}"]=198.51.100.75
+ for ip_address in "${target_listing[@]}"
+ local report_path=reports/203.0.113.25
+ local configs_objects=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.list
+ :
+ [[ -d reports/203.0.113.25 ]]
+ for ext in "${file_extensions[@]}"
+ find reports/203.0.113.25 -type f -name '*.cfg'
+ configs_targets --search=198.51.100.75 --source=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.list --target=targets/198.51.100.75.json --logger=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.console --verbose
+ for ext in "${file_extensions[@]}"
+ find reports/203.0.113.25 -type f -name '*.conf'
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.list ]]
+ local target_config=targets/203.0.113.25.json
+ local configs_targets__console=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25
+ local job_pid=68253
+ targets_jobs_pid+=("${job_pid}")
+ targets_jobs2ips_mapping["${job_pid}"]=203.0.113.25
+ ((  7 > 0  ))
+ valid_targets_jobs_pid=()
+ local valid_targets_jobs_pid
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68139
+ valid_targets_jobs_pid+=("${pid}")
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68148
+ valid_targets_jobs_pid+=("${pid}")
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68161
+ valid_targets_jobs_pid+=("${pid}")
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68180
+ valid_targets_jobs_pid+=("${pid}")
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68203
+ valid_targets_jobs_pid+=("${pid}")
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68225
+ valid_targets_jobs_pid+=("${pid}")
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68253
+ valid_targets_jobs_pid+=("${pid}")
+ targets_jobs_pid=("${valid_targets_jobs_pid[@]}")
+ configs_targets --search=203.0.113.25 --source=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.list --target=targets/203.0.113.25.json --logger=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.console --verbose
+ sleep 0.1
+ ((  7 > 0  ))
+ valid_targets_jobs_pid=()
+ local valid_targets_jobs_pid
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68139
+ logger=192.168.0.100
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68148
+ valid_targets_jobs_pid+=("${pid}")
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68161
+ logger=192.168.1.11
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68180
+ valid_targets_jobs_pid+=("${pid}")
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68203
+ logger=192.168.100.100
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68225
+ valid_targets_jobs_pid+=("${pid}")
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68253
+ valid_targets_jobs_pid+=("${pid}")
+ targets_jobs_pid=("${valid_targets_jobs_pid[@]}")
+ sleep 0.1
+ ((  4 > 0  ))
+ valid_targets_jobs_pid=()
+ local valid_targets_jobs_pid
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68148
+ logger=192.168.1.10
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68180
+ logger=192.168.2.12
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68225
+ logger=198.51.100.75
+ for pid in "${targets_jobs_pid[@]}"
+ kill -0 68253
+ logger=203.0.113.25
+ targets_jobs_pid=("${valid_targets_jobs_pid[@]}")
+ sleep 0.1
+ ((  0 > 0  ))
+ [[ true == true ]]
+ message 'Completed background jobs for matched IPs (7):'
+ [[ -n Completed background jobs for matched IPs (7): ]]
+ local 'message=Completed background jobs for matched IPs (7):'
+ echo -e 'Completed background jobs for matched IPs (7):'
+ message -------------------------------------
+ [[ -n ------------------------------------- ]]
+ local message=-------------------------------------
+ echo -e -------------------------------------
+ message ' Index  | PID    | IP Address       |'
+ [[ -n  Index  | PID    | IP Address       | ]]
+ local 'message= Index  | PID    | IP Address       |'
+ echo -e ' Index  | PID    | IP Address       |'
+ message -------------------------------------
+ [[ -n ------------------------------------- ]]
+ local message=-------------------------------------
+ echo -e -------------------------------------
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ cat -n
+ ip_address=198.51.100.75
+ printf '%-6s | %-15s\n' 68225 198.51.100.75
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=192.168.1.10
+ printf '%-6s | %-15s\n' 68148 192.168.1.10
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=192.168.2.12
+ printf '%-6s | %-15s\n' 68180 192.168.2.12
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=192.168.100.100
+ printf '%-6s | %-15s\n' 68203 192.168.100.100
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=203.0.113.25
+ printf '%-6s | %-15s\n' 68253 203.0.113.25
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=192.168.0.100
+ printf '%-6s | %-15s\n' 68139 192.168.0.100
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=192.168.1.11
+ printf '%-6s | %-15s\n' 68161 192.168.1.11
+ newline
+ local count=1
+ (( i = 0 ))
+ (( i < count ))
+ echo
+ (( i++ ))
+ (( i < count ))
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=198.51.100.75
+ target_config=targets/198.51.100.75.json
+ [[ -s targets/198.51.100.75.json ]]
+ [[ -f targets/198.51.100.75.json ]]
+ message 'Completed Configuration Targets (IP): targets/198.51.100.75.json'
+ [[ -n Completed Configuration Targets (IP): targets/198.51.100.75.json ]]
+ local 'message=Completed Configuration Targets (IP): targets/198.51.100.75.json'
+ echo -e 'Completed Configuration Targets (IP): targets/198.51.100.75.json'
+ jq -r . targets/198.51.100.75.json
+ newline
+ local count=1
+ (( i = 0 ))
+ (( i < count ))
+ echo
+ (( i++ ))
+ (( i < count ))
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=192.168.1.10
+ target_config=targets/192.168.1.10.json
+ [[ -s targets/192.168.1.10.json ]]
+ [[ -f targets/192.168.1.10.json ]]
+ message 'Completed Configuration Targets (IP): targets/192.168.1.10.json'
+ [[ -n Completed Configuration Targets (IP): targets/192.168.1.10.json ]]
+ local 'message=Completed Configuration Targets (IP): targets/192.168.1.10.json'
+ echo -e 'Completed Configuration Targets (IP): targets/192.168.1.10.json'
+ jq -r . targets/192.168.1.10.json
+ newline
+ local count=1
+ (( i = 0 ))
+ (( i < count ))
+ echo
+ (( i++ ))
+ (( i < count ))
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=192.168.2.12
+ target_config=targets/192.168.2.12.json
+ [[ -s targets/192.168.2.12.json ]]
+ [[ -f targets/192.168.2.12.json ]]
+ message 'Completed Configuration Targets (IP): targets/192.168.2.12.json'
+ [[ -n Completed Configuration Targets (IP): targets/192.168.2.12.json ]]
+ local 'message=Completed Configuration Targets (IP): targets/192.168.2.12.json'
+ echo -e 'Completed Configuration Targets (IP): targets/192.168.2.12.json'
+ jq -r . targets/192.168.2.12.json
+ newline
+ local count=1
+ (( i = 0 ))
+ (( i < count ))
+ echo
+ (( i++ ))
+ (( i < count ))
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=192.168.100.100
+ target_config=targets/192.168.100.100.json
+ [[ -s targets/192.168.100.100.json ]]
+ [[ -f targets/192.168.100.100.json ]]
+ message 'Completed Configuration Targets (IP): targets/192.168.100.100.json'
+ [[ -n Completed Configuration Targets (IP): targets/192.168.100.100.json ]]
+ local 'message=Completed Configuration Targets (IP): targets/192.168.100.100.json'
+ echo -e 'Completed Configuration Targets (IP): targets/192.168.100.100.json'
+ jq -r . targets/192.168.100.100.json
+ newline
+ local count=1
+ (( i = 0 ))
+ (( i < count ))
+ echo
+ (( i++ ))
+ (( i < count ))
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=203.0.113.25
+ target_config=targets/203.0.113.25.json
+ [[ -s targets/203.0.113.25.json ]]
+ [[ -f targets/203.0.113.25.json ]]
+ message 'Completed Configuration Targets (IP): targets/203.0.113.25.json'
+ [[ -n Completed Configuration Targets (IP): targets/203.0.113.25.json ]]
+ local 'message=Completed Configuration Targets (IP): targets/203.0.113.25.json'
+ echo -e 'Completed Configuration Targets (IP): targets/203.0.113.25.json'
+ jq -r . targets/203.0.113.25.json
+ newline
+ local count=1
+ (( i = 0 ))
+ (( i < count ))
+ echo
+ (( i++ ))
+ (( i < count ))
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=192.168.0.100
+ target_config=targets/192.168.0.100.json
+ [[ -s targets/192.168.0.100.json ]]
+ [[ -f targets/192.168.0.100.json ]]
+ message 'Completed Configuration Targets (IP): targets/192.168.0.100.json'
+ [[ -n Completed Configuration Targets (IP): targets/192.168.0.100.json ]]
+ local 'message=Completed Configuration Targets (IP): targets/192.168.0.100.json'
+ echo -e 'Completed Configuration Targets (IP): targets/192.168.0.100.json'
+ jq -r . targets/192.168.0.100.json
+ newline
+ local count=1
+ (( i = 0 ))
+ (( i < count ))
+ echo
+ (( i++ ))
+ (( i < count ))
+ for pid in "${!targets_jobs2ips_mapping[@]}"
+ ip_address=192.168.1.11
+ target_config=targets/192.168.1.11.json
+ [[ -s targets/192.168.1.11.json ]]
+ [[ -f targets/192.168.1.11.json ]]
+ message 'Completed Configuration Targets (IP): targets/192.168.1.11.json'
+ [[ -n Completed Configuration Targets (IP): targets/192.168.1.11.json ]]
+ local 'message=Completed Configuration Targets (IP): targets/192.168.1.11.json'
+ echo -e 'Completed Configuration Targets (IP): targets/192.168.1.11.json'
+ jq -r . targets/192.168.1.11.json
+ newline
+ local count=1
+ (( i = 0 ))
+ (( i < count ))
+ echo
+ (( i++ ))
+ (( i < count ))
+ return 0
 ]]
+ [[ target =~ ^(source|s)$ ]]
+ [[ search == \v\e\r\b\o\s\e ]]
+ for xitem in "${@}"
+ [[ target =~ ^(target|t)$ ]]
+ IFS==
+ read -r key value
+ local target_config=targets/192.168.100.100.json
+ [[ target =~ ^(logger|l)$ ]]
+ [[ target == \d\e\b\u\g ]]
+ [[ target == \d\r\y\-\r\u\n ]]
+ [[ target == \v\e\r\b\o\s\e ]]
+ for xitem in "${@}"
+ IFS==
+ read -r key value
++ echo -e --source=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.list
++ sed -e '1s|^\(-\)\{1,\}||'
+ json_head='{
  "vendor": "cisco",
  "model": "",
  "version": "16.9",
  "domain": "",
  "hostname": "branch-isr-02"
}'
++ echo -e --logger=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.100.100.console
++ sed -e '1s|^\(-\)\{1,\}||'
+ echo '{
  "vendor": "cisco",
  "model": "",
  "version": "16.9",
  "domain": "",
  "hostname": "branch-isr-02"
}'
+ [[ verbose =~ ^(search|p)$ ]]
+ jq -e .
+ [[ verbose =~ ^(source|s)$ ]]
+ [[ verbose =~ ^(target|t)$ ]]
+ [[ verbose =~ ^(logger|l)$ ]]
+ [[ verbose == \d\e\b\u\g ]]
+ [[ verbose == \d\r\y\-\r\u\n ]]
+ [[ verbose == \v\e\r\b\o\s\e ]]
+ local verbose=true
+ IFS=' 	
'
+ [[ -z true ]]
+ [[ -z false ]]
+ [[ -z true ]]
+ [[ -z /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.2.12.list ]]
+ [[ -z /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.2.12.console ]]
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.2.12.list ]]
+ site_device_map=()
+ declare -A site_device_map
+ local rel_path site device cfg_lines json_head json_spec
+ IFS=
+ read -r config_file
+ [[ ! -f reports/192.168.2.12/misc/fw1.cfg ]]
+ rel_path=reports/192.168.2.12/misc/fw1.cfg
+ site=reports
+ device=fw1.cfg
+ oIFS=' 	
'
+ for xitem in "${@}"
+ IFS==
+ read -r key value
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "12.4",
    "domain": "",
    "hostname": "access-sw1-west"
  },
  "config": {
    "file": "access-sw1-west.cfg",
    "lines": 21,
    "object": ".objects/access-sw1-west.list"
+ [[ source =~ ^(search|p)$ ]]
  }
}'
+ [[ source =~ ^(source|s)$ ]]
+ site_device_map["${site}"]+='{
  "specs": {
+ local source_config=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.list
    "vendor": "cisco",
    "model": "",
+ [[ source =~ ^(target|t)$ ]]
    "version": "12.4",
    "domain": "",
    "hostname": "access-sw1-west"
  },
+ [[ source =~ ^(logger|l)$ ]]
  "config": {
    "file": "access-sw1-west.cfg",
+ [[ source == \d\e\b\u\g ]]
    "lines": 21,
+ [[ source == \d\r\y\-\r\u\n ]]
    "object": ".objects/access-sw1-west.list"
+ [[ source == \v\e\r\b\o\s\e ]]
  }
+ for xitem in "${@}"
}
'
+ IFS==
+ read -r key value
+ [[ logger =~ ^(search|p)$ ]]
+ IFS=
+ read -r config_file
++ wc -l
+ [[ logger =~ ^(source|s)$ ]]
+ [[ ! -f reports/192.168.0.100/cisco/campus-sw-access01.cfg ]]
++ jq -n --arg file fw3.cfg --argjson lines 14 --arg path .objects/fw3.list --arg specs '{
+ [[ logger =~ ^(target|t)$ ]]
  "vendor": "cisco",
+ rel_path=reports/192.168.0.100/cisco/campus-sw-access01.cfg
  "model": "",
+ site=reports
+ [[ logger =~ ^(logger|l)$ ]]
  "version": "",
+ device=campus-sw-access01.cfg
  "domain": "",
  "hostname": ""
}' '{
            specs: ($specs | fromjson),
            config: {
+ local target_logfile=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.100.100.console
              file: $file,
              lines: $lines,
+ [[ logger == \d\e\b\u\g ]]
              object: $path
            }
+ [[ logger == \d\r\y\-\r\u\n ]]
          }'
+ [[ logger == \v\e\r\b\o\s\e ]]
++ echo -e --search=203.0.113.25
++ tr -d ' '
+ for xitem in "${@}"
+ IFS==
+ read -r key value
++ sed -e '1s|^\(-\)\{1,\}||'
++ echo -e --target=targets/198.51.100.75.json
++ wc -l
++ sed -e '1s|^\(-\)\{1,\}||'
++ tr -d ' '
++ echo -e --verbose
++ sed -e '1s|^\(-\)\{1,\}||'
+ cfg_lines=14
+ [[ search =~ ^(search|p)$ ]]
+ local search_pattern=203.0.113.25
+ [[ search =~ ^(source|s)$ ]]
+ [[ search =~ ^(target|t)$ ]]
+ [[ search =~ ^(logger|l)$ ]]
+ [[ search == \d\e\b\u\g ]]
+ [[ search == \d\r\y\-\r\u\n ]]
+ [[ search == \v\e\r\b\o\s\e ]]
+ for xitem in "${@}"
+ IFS==
+ read -r key value
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/192.168.2.12/misc/fw1.cfg
+ [[ target =~ ^(search|p)$ ]]
+ [[ verbose =~ ^(search|p)$ ]]
+ [[ target =~ ^(source|s)$ ]]
+ [[ verbose =~ ^(source|s)$ ]]
+ [[ verbose =~ ^(target|t)$ ]]
+ [[ target =~ ^(target|t)$ ]]
+ [[ verbose =~ ^(logger|l)$ ]]
+ [[ verbose == \d\e\b\u\g ]]
+ [[ verbose == \d\r\y\-\r\u\n ]]
+ cfg_lines=17
+ [[ verbose == \v\e\r\b\o\s\e ]]
+ local target_config=targets/198.51.100.75.json
+ local verbose=true
+ [[ target =~ ^(logger|l)$ ]]
+ IFS=' 	
'
+ [[ -z true ]]
+ [[ -z false ]]
+ [[ target == \d\e\b\u\g ]]
+ [[ -z true ]]
+ [[ target == \d\r\y\-\r\u\n ]]
+ [[ -z /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.100.100.list ]]
+ [[ target == \v\e\r\b\o\s\e ]]
+ [[ -z /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.100.100.console ]]
+ for xitem in "${@}"
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--192.168.100.100.list ]]
+ IFS==
+ read -r key value
+ site_device_map=()
+ declare -A site_device_map
+ local rel_path site device cfg_lines json_head json_spec
+ IFS=
+ read -r config_file
+ [[ ! -f reports/192.168.100.100/cisco/dmz-fw2-backup.cfg ]]
+ rel_path=reports/192.168.100.100/cisco/dmz-fw2-backup.cfg
+ site=reports
+ device=dmz-fw2-backup.cfg
++ echo -e --source=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.list
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/192.168.0.100/cisco/campus-sw-access01.cfg
++ sed -e '1s|^\(-\)\{1,\}||'
++ echo -e --logger=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.console
++ wc -l
++ sed -e '1s|^\(-\)\{1,\}||'
++ tr -d ' '
+ json_head='{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}'
+ echo '{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}'
+ jq -e .
+ json_head='{
  "vendor": "cisco",
  "model": "",
  "version": "12.2",
  "domain": "",
  "hostname": "campus-sw-access01"
}'
+ [[ source =~ ^(search|p)$ ]]
+ [[ source =~ ^(source|s)$ ]]
+ local source_config=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.list
+ [[ source =~ ^(target|t)$ ]]
+ [[ source =~ ^(logger|l)$ ]]
+ [[ source == \d\e\b\u\g ]]
+ [[ source == \d\r\y\-\r\u\n ]]
+ [[ source == \v\e\r\b\o\s\e ]]
+ for xitem in "${@}"
+ IFS==
+ read -r key value
++ jq -n --arg file branch-isr-02.cfg --argjson lines 16 --arg path .objects/branch-isr-02.list --arg specs '{
  "vendor": "cisco",
  "model": "",
  "version": "16.9",
  "domain": "",
  "hostname": "branch-isr-02"
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ echo '{
  "vendor": "cisco",
  "model": "",
  "version": "12.2",
  "domain": "",
  "hostname": "campus-sw-access01"
}'
+ [[ logger =~ ^(search|p)$ ]]
+ jq -e .
+ [[ logger =~ ^(source|s)$ ]]
+ [[ logger =~ ^(target|t)$ ]]
+ [[ logger =~ ^(logger|l)$ ]]
+ local target_logfile=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.console
+ [[ logger == \d\e\b\u\g ]]
+ cfg_lines=26
+ [[ logger == \d\r\y\-\r\u\n ]]
+ [[ logger == \v\e\r\b\o\s\e ]]
+ for xitem in "${@}"
+ IFS==
+ read -r key value
++ echo -e --target=targets/203.0.113.25.json
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/192.168.100.100/cisco/dmz-fw2-backup.cfg
++ sed -e '1s|^\(-\)\{1,\}||'
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 14,
    "object": ".objects/fw3.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 14,
    "object": ".objects/fw3.list"
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/192.168.1.10/misc/fw1.cfg ]]
+ rel_path=reports/192.168.1.10/misc/fw1.cfg
+ site=reports
+ device=fw1.cfg
++ echo -e --verbose
++ sed -e '1s|^\(-\)\{1,\}||'
++ wc -l
++ tr -d ' '
+ json_head='{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.12(4)",
  "domain": "global.dmz.example.net",
  "hostname": "dmz-fw2-backup"
}'
+ [[ target =~ ^(search|p)$ ]]
+ [[ target =~ ^(source|s)$ ]]
+ [[ target =~ ^(target|t)$ ]]
+ local target_config=targets/203.0.113.25.json
+ [[ target =~ ^(logger|l)$ ]]
+ [[ target == \d\e\b\u\g ]]
+ [[ target == \d\r\y\-\r\u\n ]]
+ [[ target == \v\e\r\b\o\s\e ]]
+ for xitem in "${@}"
+ IFS==
+ read -r key value
+ echo '{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.12(4)",
  "domain": "global.dmz.example.net",
  "hostname": "dmz-fw2-backup"
}'
+ [[ verbose =~ ^(search|p)$ ]]
+ [[ verbose =~ ^(source|s)$ ]]
+ [[ verbose =~ ^(target|t)$ ]]
+ [[ verbose =~ ^(logger|l)$ ]]
+ jq -e .
+ [[ verbose == \d\e\b\u\g ]]
+ [[ verbose == \d\r\y\-\r\u\n ]]
+ [[ verbose == \v\e\r\b\o\s\e ]]
+ local verbose=true
+ IFS=' 	
'
+ [[ -z true ]]
+ [[ -z false ]]
+ [[ -z true ]]
+ [[ -z /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.list ]]
+ [[ -z /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.console ]]
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--198.51.100.75.list ]]
+ site_device_map=()
+ declare -A site_device_map
+ local rel_path site device cfg_lines json_head json_spec
+ IFS=
+ read -r config_file
+ [[ ! -f reports/198.51.100.75/misc/fw1.cfg ]]
+ rel_path=reports/198.51.100.75/misc/fw1.cfg
+ site=reports
+ device=fw1.cfg
++ echo -e --logger=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.console
+ cfg_lines=13
++ sed -e '1s|^\(-\)\{1,\}||'
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/192.168.1.10/misc/fw1.cfg
++ wc -l
++ tr -d ' '
+ [[ logger =~ ^(search|p)$ ]]
+ [[ logger =~ ^(source|s)$ ]]
+ [[ logger =~ ^(target|t)$ ]]
+ [[ logger =~ ^(logger|l)$ ]]
+ local target_logfile=/var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.console
+ [[ logger == \d\e\b\u\g ]]
+ [[ logger == \d\r\y\-\r\u\n ]]
+ [[ logger == \v\e\r\b\o\s\e ]]
+ for xitem in "${@}"
+ IFS==
+ json_spec='{
  "specs": {
+ read -r key value
++ jq -n --arg file fw1.cfg --argjson lines 14 --arg path .objects/fw1.list --arg specs '{
    "vendor": "cisco",
  "vendor": "cisco",
    "model": "",
  "model": "",
    "version": "16.9",
  "version": "",
    "domain": "",
  "domain": "",
  "hostname": ""
}' '{
            specs: ($specs | fromjson),
    "hostname": "branch-isr-02"
  },
            config: {
  "config": {
              file: $file,
    "file": "branch-isr-02.cfg",
              lines: $lines,
    "lines": 16,
              object: $path
    "object": ".objects/branch-isr-02.list"
            }
  }
          }'
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
+ json_head='{
  "vendor": "cisco",
    "domain": "",
  "model": "",
    "hostname": "branch-isr-02"
  "version": "",
  },
  "domain": "",
  "config": {
  "hostname": ""
    "file": "branch-isr-02.cfg",
}'
    "lines": 16,
++ jq -n --arg file campus-sw-access01.cfg --argjson lines 17 --arg path .objects/campus-sw-access01.list --arg specs '{
    "object": ".objects/branch-isr-02.list"
  "vendor": "cisco",
  }
  "model": "",
}
  "version": "12.2",
'
  "domain": "",
+ cfg_lines=17
  "hostname": "campus-sw-access01"
+ IFS=
}' '{
+ read -r config_file
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ [[ ! -f reports/192.168.1.11/fortinet/fg-campus-core.cfg ]]
+ rel_path=reports/192.168.1.11/fortinet/fg-campus-core.cfg
+ site=reports
+ device=fg-campus-core.cfg
+ echo '{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}'
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/198.51.100.75/misc/fw1.cfg
+ jq -e .
++ echo -e --verbose
++ sed -e '1s|^\(-\)\{1,\}||'
++ wc -l
++ tr -d ' '
+ json_head='{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}'
+ [[ verbose =~ ^(search|p)$ ]]
+ [[ verbose =~ ^(source|s)$ ]]
+ [[ verbose =~ ^(target|t)$ ]]
+ [[ verbose =~ ^(logger|l)$ ]]
+ [[ verbose == \d\e\b\u\g ]]
+ [[ verbose == \d\r\y\-\r\u\n ]]
+ [[ verbose == \v\e\r\b\o\s\e ]]
+ local verbose=true
+ IFS=' 	
'
+ [[ -z true ]]
+ [[ -z false ]]
+ [[ -z true ]]
+ [[ -z /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.list ]]
+ [[ -z /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.console ]]
+ [[ ! -s /var/folders/vp/4k9xy96d7zx8lhmgrr4khsj80000gn/T/tmp.UBKcg8jWc4/configs-targets--203.0.113.25.list ]]
+ site_device_map=()
+ declare -A site_device_map
+ local rel_path site device cfg_lines json_head json_spec
+ echo '{
+ IFS=
  "vendor": "cisco",
+ read -r config_file
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
+ [[ ! -f reports/203.0.113.25/misc/fw3.cfg ]]
}'
+ rel_path=reports/203.0.113.25/misc/fw3.cfg
+ site=reports
+ device=fw3.cfg
+ jq -e .
+ cfg_lines=18
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/192.168.1.11/fortinet/fg-campus-core.cfg
++ jq -n --arg file dmz-fw2-backup.cfg --argjson lines 26 --arg path .objects/dmz-fw2-backup.list --arg specs '{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.12(4)",
  "domain": "global.dmz.example.net",
  "hostname": "dmz-fw2-backup"
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
++ wc -l
++ tr -d ' '
+ cfg_lines=13
+ json_head='{
  "vendor": "fortinet",
  "model": "FortiGate-200F",
  "version": "",
  "domain": "",
  "hostname": "fg-campus-core"
}'
+ echo '{
  "vendor": "fortinet",
  "model": "FortiGate-200F",
  "version": "",
  "domain": "",
  "hostname": "fg-campus-core"
}'
+ jq -e .
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/203.0.113.25/misc/fw3.cfg
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "12.2",
    "domain": "",
    "hostname": "campus-sw-access01"
  },
  "config": {
    "file": "campus-sw-access01.cfg",
    "lines": 17,
    "object": ".objects/campus-sw-access01.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "12.2",
    "domain": "",
    "hostname": "campus-sw-access01"
  },
  "config": {
    "file": "campus-sw-access01.cfg",
    "lines": 17,
    "object": ".objects/campus-sw-access01.list"
  }
}
'
+ IFS=
+ read -r config_file
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 14,
    "object": ".objects/fw1.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 14,
    "object": ".objects/fw1.list"
  }
}
'
+ IFS=
+ printf ' { "target": "%s", "locations": { ' 192.168.0.100
+ read -r config_file
+ first=true
+ [[ ! -f reports/192.168.2.12/cisco/branch-isr-02.cfg ]]
+ rel_path=reports/192.168.2.12/cisco/branch-isr-02.cfg
+ site=reports
+ device=branch-isr-02.cfg
+ jq .
++ jq -n --arg file fw1.cfg --argjson lines 13 --arg path .objects/fw1.list --arg specs '{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
++ wc -l
++ printf '%s\n' reports
+ json_head='{
  "vendor": "cisco",
  "model": "",
  "version": "",
++ sort -u
  "domain": "",
++ tr -d ' '
  "hostname": ""
}'
+ echo '{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}'
+ jq -e .
++ jq -n --arg file fw1.cfg --argjson lines 17 --arg path .objects/fw1.list --arg specs '{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ for site in $(printf '%s\n' "${!site_device_map[@]}" | sort -u)
+ cfg_lines=20
+ [[ -z {
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "12.4",
    "domain": "",
    "hostname": "access-sw1-west"
  },
  "config": {
    "file": "access-sw1-west.cfg",
    "lines": 21,
    "object": ".objects/access-sw1-west.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "12.2",
    "domain": "",
    "hostname": "campus-sw-access01"
  },
  "config": {
    "file": "campus-sw-access01.cfg",
    "lines": 17,
    "object": ".objects/campus-sw-access01.list"
  }
}
 ]]
+ true
+ first=false
+ printf ' "%s": { "devices": ' reports
++ awk '
+ print '{
          BEGIN { in_json=0; depth=0; }
          {
  "specs": {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
    "vendor": "cisco",
            if (in_json) {
    "model": "",
+ json_spec='{
  "specs": {
    "version": "12.4",
    "vendor": "cisco",
    "domain": "",
    "hostname": "access-sw1-west"
              print;
  },
    "model": "ASA",
  "config": {
              depth += gsub(/{/, "{");
    "version": "9.12(4)",
    "file": "access-sw1-west.cfg",
              depth -= gsub(/}/, "}");
+ jq -s .
    "domain": "global.dmz.example.net",
    "lines": 21,
    "hostname": "dmz-fw2-backup"
    "object": ".objects/access-sw1-west.list"
              if (depth == 0) exit;
  },
  "config": {
            }
    "file": "dmz-fw2-backup.cfg",
          }
    "lines": 26,
        ' reports/192.168.2.12/cisco/branch-isr-02.cfg
  }
    "object": ".objects/dmz-fw2-backup.list"
  }
}'
}
{
  "specs": {
    "vendor": "cisco",
+ site_device_map["${site}"]+='{
    "model": "",
  "specs": {
    "version": "12.2",
    "vendor": "cisco",
    "domain": "",
    "model": "ASA",
    "hostname": "campus-sw-access01"
    "version": "9.12(4)",
  },
    "domain": "global.dmz.example.net",
  "config": {
    "hostname": "dmz-fw2-backup"
    "file": "campus-sw-access01.cfg",
  },
    "lines": 17,
  "config": {
    "object": ".objects/campus-sw-access01.list"
    "file": "dmz-fw2-backup.cfg",
  }
    "lines": 26,
}
    "object": ".objects/dmz-fw2-backup.list"
'
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/192.168.100.100/fortinet/fg-campus-core.cfg ]]
+ [[ -n {
+ rel_path=reports/192.168.100.100/fortinet/fg-campus-core.cfg
  "specs": {
+ site=reports
    "vendor": "cisco",
    "model": "",
    "version": "12.4",
+ device=fg-campus-core.cfg
    "domain": "",
    "hostname": "access-sw1-west"
  },
  "config": {
    "file": "access-sw1-west.cfg",
    "lines": 21,
    "object": ".objects/access-sw1-west.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "12.2",
    "domain": "",
    "hostname": "campus-sw-access01"
  },
  "config": {
    "file": "campus-sw-access01.cfg",
    "lines": 17,
    "object": ".objects/campus-sw-access01.list"
  }
}
 ]]
+ echo -en '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "12.4",
    "domain": "",
    "hostname": "access-sw1-west"
  },
  "config": {
    "file": "access-sw1-west.cfg",
    "lines": 21,
    "object": ".objects/access-sw1-west.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "12.2",
    "domain": "",
    "hostname": "campus-sw-access01"
  },
  "config": {
    "file": "campus-sw-access01.cfg",
    "lines": 17,
    "object": ".objects/campus-sw-access01.list"
  }
}
'
++ wc -l
++ tr -d ' '
+ json_head='{
  "vendor": "cisco",
  "model": "",
  "version": "16.9",
  "domain": "",
  "hostname": "branch-isr-02"
}'
+ echo '{
++ jq -n --arg file fg-campus-core.cfg --argjson lines 18 --arg path .objects/fg-campus-core.list --arg specs '{
  "vendor": "cisco",
  "vendor": "fortinet",
  "model": "",
  "model": "FortiGate-200F",
  "version": "16.9",
  "version": "",
  "domain": "",
  "domain": "",
  "hostname": "branch-isr-02"
  "hostname": "fg-campus-core"
}'
+ jq -e .
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ cfg_lines=32
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 13,
    "object": ".objects/fw1.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 13,
    "object": ".objects/fw1.list"
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/192.168.1.10/fortinet/fg-branch-vpn-01.cfg ]]
+ rel_path=reports/192.168.1.10/fortinet/fg-branch-vpn-01.cfg
+ site=reports
+ device=fg-branch-vpn-01.cfg
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/192.168.100.100/fortinet/fg-campus-core.cfg
++ wc -l
++ tr -d ' '
++ jq -n --arg file fw3.cfg --argjson lines 13 --arg path .objects/fw3.list --arg specs '{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/198.51.100.75/cisco/branch-isr-02.cfg ]]
+ rel_path=reports/198.51.100.75/cisco/branch-isr-02.cfg
+ site=reports
+ device=branch-isr-02.cfg
+ json_head='{
  "vendor": "fortinet",
  "model": "FortiGate-200F",
  "version": "",
  "domain": "",
  "hostname": "fg-campus-core"
}'
+ printf ' } '
+ printf ' } } '
+ echo '{
  "vendor": "fortinet",
  "model": "FortiGate-200F",
  "version": "",
  "domain": "",
  "hostname": "fg-campus-core"
}'
+ jq -e .
++ wc -l
+ cfg_lines=19
++ tr -d ' '
+ return 0
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/192.168.1.10/fortinet/fg-branch-vpn-01.cfg
+ cfg_lines=20
+ json_head='{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}'
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/198.51.100.75/cisco/branch-isr-02.cfg
+ json_spec='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}
'
+ IFS=
+ read -r config_file
+ echo '{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}'
+ jq -e .
+ printf ' { "target": "%s", "locations": { ' 192.168.1.11
+ first=true
++ jq -n --arg file branch-isr-02.cfg --argjson lines 20 --arg path .objects/branch-isr-02.list --arg specs '{
  "vendor": "cisco",
  "model": "",
  "version": "16.9",
  "domain": "",
  "hostname": "branch-isr-02"
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ jq .
++ printf '%s\n' reports
+ json_spec='{
  "specs": {
+ json_head='{
    "vendor": "cisco",
++ sort -u
  "vendor": "cisco",
    "model": "",
  "model": "",
  "version": "16.9",
    "version": "",
  "domain": "",
    "domain": "",
  "hostname": "branch-isr-02"
    "hostname": ""
}'
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 13,
    "object": ".objects/fw3.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 13,
    "object": ".objects/fw3.list"
  }
}
'
+ IFS=
+ read -r config_file
+ echo '{
  "vendor": "cisco",
  "model": "",
  "version": "16.9",
+ [[ ! -f reports/203.0.113.25/misc/fw1.cfg ]]
  "domain": "",
  "hostname": "branch-isr-02"
}'
+ rel_path=reports/203.0.113.25/misc/fw1.cfg
+ site=reports
+ device=fw1.cfg
+ jq -e .
++ wc -l
++ tr -d ' '
+ for site in $(printf '%s\n' "${!site_device_map[@]}" | sort -u)
+ [[ -z {
  "specs": {
    "vendor": "cisco",
++ jq -n --arg file fg-campus-core.cfg --argjson lines 32 --arg path .objects/fg-campus-core.list --arg specs '{
  "vendor": "fortinet",
    "model": "",
    "version": "16.9",
  "model": "FortiGate-200F",
    "domain": "",
  "version": "",
    "hostname": "branch-isr-02"
  "domain": "",
  },
  "hostname": "fg-campus-core"
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 16,
    "object": ".objects/branch-isr-02.list"
}' '{
  }
            specs: ($specs | fromjson),
}
            config: {
{
              file: $file,
  "specs": {
              lines: $lines,
    "vendor": "fortinet",
              object: $path
    "model": "FortiGate-200F",
            }
    "version": "",
          }'
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}
 ]]
+ true
+ first=false
+ printf ' "%s": { "devices": ' reports
+ print '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 16,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}
'
+ jq -s .
+ [[ -n {
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 16,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}
 ]]
+ echo -en '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 16,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}
'
+ cfg_lines=17
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/203.0.113.25/misc/fw1.cfg
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/192.168.2.12/fortinet/fg-campus-core.cfg ]]
+ rel_path=reports/192.168.2.12/fortinet/fg-campus-core.cfg
+ site=reports
+ device=fg-campus-core.cfg
++ jq -n --arg file fg-branch-vpn-01.cfg --argjson lines 19 --arg path .objects/fg-branch-vpn-01.list --arg specs '{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
++ wc -l
+ json_head='{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}'
++ tr -d ' '
+ echo '{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}'
+ jq -e .
++ jq -n --arg file branch-isr-02.cfg --argjson lines 20 --arg path .objects/branch-isr-02.list --arg specs '{
  "vendor": "cisco",
  "model": "",
  "version": "16.9",
  "domain": "",
  "hostname": "branch-isr-02"
+ cfg_lines=18
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/192.168.2.12/fortinet/fg-campus-core.cfg
+ printf ' } '
+ json_spec='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 32,
    "object": ".objects/fg-campus-core.list"
+ printf ' } } '
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 32,
    "object": ".objects/fg-campus-core.list"
  }
}
'
+ IFS=
+ read -r config_file
+ printf ' { "target": "%s", "locations": { ' 192.168.100.100
+ first=true
+ jq .
+ return 0
+ json_head='{
  "vendor": "fortinet",
  "model": "FortiGate-200F",
  "version": "",
  "domain": "",
  "hostname": "fg-campus-core"
}'
+ echo '{
  "vendor": "fortinet",
  "model": "FortiGate-200F",
  "version": "",
++ printf '%s\n' reports
  "domain": "",
  "hostname": "fg-campus-core"
}'
+ jq -e .
++ sort -u
+ json_spec='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
'
+ for site in $(printf '%s\n' "${!site_device_map[@]}" | sort -u)
+ IFS=
+ read -r config_file
+ [[ ! -f reports/192.168.1.10/misc/switch1.conf ]]
+ [[ -z {
+ rel_path=reports/192.168.1.10/misc/switch1.conf
  "specs": {
+ site=reports
    "vendor": "cisco",
+ device=switch1.conf
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 26,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 32,
    "object": ".objects/fg-campus-core.list"
  }
}
 ]]
++ jq -n --arg file fw1.cfg --argjson lines 17 --arg path .objects/fw1.list --arg specs '{
  "vendor": "cisco",
+ true
  "model": "",
  "version": "",
+ first=false
  "domain": "",
  "hostname": ""
}' '{
+ printf ' "%s": { "devices": ' reports
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ print '{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 26,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 32,
    "object": ".objects/fg-campus-core.list"
  }
}
'
+ jq -s .
++ wc -l
+ [[ -n {
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 26,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
++ tr -d ' '
    "file": "fg-campus-core.cfg",
    "lines": 32,
    "object": ".objects/fg-campus-core.list"
  }
}
 ]]
+ echo -en '{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 26,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 32,
    "object": ".objects/fg-campus-core.list"
  }
}
'
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/198.51.100.75/cisco/dmz-fw2-backup.cfg ]]
+ rel_path=reports/198.51.100.75/cisco/dmz-fw2-backup.cfg
+ site=reports
+ device=dmz-fw2-backup.cfg
++ wc -l
++ tr -d ' '
+ cfg_lines=11
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/192.168.1.10/misc/switch1.conf
++ jq -n --arg file fg-campus-core.cfg --argjson lines 18 --arg path .objects/fg-campus-core.list --arg specs '{
  "vendor": "fortinet",
  "model": "FortiGate-200F",
  "version": "",
+ cfg_lines=17
  "domain": "",
  "hostname": "fg-campus-core"
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/198.51.100.75/cisco/dmz-fw2-backup.cfg
+ json_head='{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}'
+ echo '{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}'
+ jq -e .
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
+ printf ' } '
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
+ printf ' } } '
    "object": ".objects/fw1.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/203.0.113.25/cisco/perimeter-fw1.cfg ]]
+ rel_path=reports/203.0.113.25/cisco/perimeter-fw1.cfg
+ site=reports
+ device=perimeter-fw1.cfg
+ json_head='{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.12(4)",
  "domain": "global.dmz.example.net",
  "hostname": "dmz-fw2-backup"
}'
+ return 0
+ echo '{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.12(4)",
  "domain": "global.dmz.example.net",
  "hostname": "dmz-fw2-backup"
}'
+ jq -e .
++ wc -l
++ tr -d ' '
+ cfg_lines=33
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/203.0.113.25/cisco/perimeter-fw1.cfg
+ json_spec='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/192.168.2.12/fortinet/fg-branch-vpn-01.cfg ]]
+ rel_path=reports/192.168.2.12/fortinet/fg-branch-vpn-01.cfg
+ site=reports
+ device=fg-branch-vpn-01.cfg
++ wc -l
++ tr -d ' '
+ json_head='{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.14(3)",
  "domain": "edge.dc.example.com",
  "hostname": "perimeter-fw1"
}'
+ echo '{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.14(3)",
  "domain": "edge.dc.example.com",
  "hostname": "perimeter-fw1"
}'
++ jq -n --arg file switch1.conf --argjson lines 11 --arg path .objects/switch1.conf.list --arg specs '{
  "vendor": "cisco",
  "model": "",
  "version": "",
  "domain": "",
  "hostname": ""
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
+ jq -e .
          }'
+ cfg_lines=26
++ jq -n --arg file dmz-fw2-backup.cfg --argjson lines 17 --arg path .objects/dmz-fw2-backup.list --arg specs '{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.12(4)",
  "domain": "global.dmz.example.net",
  "hostname": "dmz-fw2-backup"
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/192.168.2.12/fortinet/fg-branch-vpn-01.cfg
+ json_head='{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}'
+ echo '{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}'
+ jq -e .
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "switch1.conf",
    "lines": 11,
    "object": ".objects/switch1.conf.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "switch1.conf",
    "lines": 11,
    "object": ".objects/switch1.conf.list"
  }
}
'
+ IFS=
+ read -r config_file
++ jq -n --arg file perimeter-fw1.cfg --argjson lines 33 --arg path .objects/perimeter-fw1.list --arg specs '{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.14(3)",
  "domain": "edge.dc.example.com",
  "hostname": "perimeter-fw1"
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ printf ' { "target": "%s", "locations": { ' 192.168.1.10
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
+ first=true
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 17,
    "object": ".objects/dmz-fw2-backup.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 17,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/198.51.100.75/fortinet/fg-branch-vpn-01.cfg ]]
+ jq .
+ rel_path=reports/198.51.100.75/fortinet/fg-branch-vpn-01.cfg
+ site=reports
+ device=fg-branch-vpn-01.cfg
++ printf '%s\n' reports
++ sort -u
++ wc -l
++ tr -d ' '
+ for site in $(printf '%s\n' "${!site_device_map[@]}" | sort -u)
+ [[ -z {
+ cfg_lines=26
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 14,
    "object": ".objects/fw3.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 13,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "switch1.conf",
    "lines": 11,
    "object": ".objects/switch1.conf.list"
  }
}
 ]]
+ true
+ first=false
+ printf ' "%s": { "devices": ' reports
++ jq -n --arg file fg-branch-vpn-01.cfg --argjson lines 26 --arg path .objects/fg-branch-vpn-01.list --arg specs '{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/198.51.100.75/fortinet/fg-branch-vpn-01.cfg
+ print '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 14,
    "object": ".objects/fw3.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 13,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "switch1.conf",
    "lines": 11,
    "object": ".objects/switch1.conf.list"
  }
}
'
+ jq -s .
+ [[ -n {
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 14,
    "object": ".objects/fw3.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 13,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "switch1.conf",
    "lines": 11,
    "object": ".objects/switch1.conf.list"
  }
}
 ]]
+ echo -en '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 14,
    "object": ".objects/fw3.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 13,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "switch1.conf",
    "lines": 11,
    "object": ".objects/switch1.conf.list"
  }
}
'
+ json_head='{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}'
+ echo '{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}'
+ jq -e .
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.14(3)",
    "domain": "edge.dc.example.com",
    "hostname": "perimeter-fw1"
  },
  "config": {
    "file": "perimeter-fw1.cfg",
    "lines": 33,
    "object": ".objects/perimeter-fw1.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.14(3)",
    "domain": "edge.dc.example.com",
    "hostname": "perimeter-fw1"
  },
  "config": {
    "file": "perimeter-fw1.cfg",
    "lines": 33,
    "object": ".objects/perimeter-fw1.list"
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/203.0.113.25/cisco/dmz-fw2-backup.cfg ]]
+ rel_path=reports/203.0.113.25/cisco/dmz-fw2-backup.cfg
+ site=reports
+ device=dmz-fw2-backup.cfg
++ wc -l
++ tr -d ' '
+ cfg_lines=16
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
+ json_spec='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
    "domain": "",
            if (in_json) {
    "hostname": "fg-branch-vpn-01"
              print;
  },
              depth += gsub(/{/, "{");
  "config": {
              depth -= gsub(/}/, "}");
    "file": "fg-branch-vpn-01.cfg",
              if (depth == 0) exit;
    "lines": 26,
            }
+ printf ' } '
    "object": ".objects/fg-branch-vpn-01.list"
          }
  }
}'
        ' reports/203.0.113.25/cisco/dmz-fw2-backup.cfg
+ printf ' } } '
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
'
+ IFS=
+ read -r config_file
+ printf ' { "target": "%s", "locations": { ' 192.168.2.12
+ first=true
+ return 0
+ jq .
++ printf '%s\n' reports
++ sort -u
+ json_head='{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.12(4)",
  "domain": "global.dmz.example.net",
  "hostname": "dmz-fw2-backup"
}'
+ echo '{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.12(4)",
  "domain": "global.dmz.example.net",
  "hostname": "dmz-fw2-backup"
}'
+ jq -e .
++ jq -n --arg file fg-branch-vpn-01.cfg --argjson lines 26 --arg path .objects/fg-branch-vpn-01.list --arg specs '{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ for site in $(printf '%s\n' "${!site_device_map[@]}" | sort -u)
+ [[ -z {
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 14,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
 ]]
+ true
+ first=false
+ printf ' "%s": { "devices": ' reports
+ print '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 14,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
+ jq -s .
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
'
+ [[ -n {
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 14,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
 ]]
+ echo -en '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 14,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-200F",
    "version": "",
    "domain": "",
    "hostname": "fg-campus-core"
  },
  "config": {
    "file": "fg-campus-core.cfg",
    "lines": 18,
    "object": ".objects/fg-campus-core.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
'
+ json_spec='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
'
+ IFS=
+ read -r config_file
++ jq -n --arg file dmz-fw2-backup.cfg --argjson lines 16 --arg path .objects/dmz-fw2-backup.list --arg specs '{
  "vendor": "cisco",
  "model": "ASA",
  "version": "9.12(4)",
  "domain": "global.dmz.example.net",
  "hostname": "dmz-fw2-backup"
}' '{
            specs: ($specs | fromjson),
+ printf ' { "target": "%s", "locations": { ' 198.51.100.75
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ first=true
+ jq .
++ printf '%s\n' reports
+ printf ' } '
+ printf ' } } '
++ sort -u
+ return 0
+ for site in $(printf '%s\n' "${!site_device_map[@]}" | sort -u)
+ [[ -z {
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 17,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
 ]]
+ true
+ first=false
+ printf ' "%s": { "devices": ' reports
+ print '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
+ jq -s .
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 17,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
'
+ [[ -n {
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 17,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
 ]]
+ echo -en '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "16.9",
    "domain": "",
    "hostname": "branch-isr-02"
  },
  "config": {
    "file": "branch-isr-02.cfg",
    "lines": 20,
    "object": ".objects/branch-isr-02.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 17,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 26,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
'
+ json_spec='{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 16,
    "object": ".objects/dmz-fw2-backup.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 16,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
'
+ IFS=
+ read -r config_file
+ [[ ! -f reports/203.0.113.25/fortinet/fg-branch-vpn-01.cfg ]]
+ rel_path=reports/203.0.113.25/fortinet/fg-branch-vpn-01.cfg
+ site=reports
+ device=fg-branch-vpn-01.cfg
++ wc -l
++ tr -d ' '
+ printf ' } '
+ cfg_lines=19
+ printf ' } } '
++ awk '
          BEGIN { in_json=0; depth=0; }
          {
            if (!in_json && $0 ~ /^[[:space:]]*{/) in_json=1;
            if (in_json) {
              print;
              depth += gsub(/{/, "{");
              depth -= gsub(/}/, "}");
              if (depth == 0) exit;
            }
          }
        ' reports/203.0.113.25/fortinet/fg-branch-vpn-01.cfg
+ return 0
+ json_head='{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}'
+ echo '{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}'
+ jq -e .
++ jq -n --arg file fg-branch-vpn-01.cfg --argjson lines 19 --arg path .objects/fg-branch-vpn-01.list --arg specs '{
  "vendor": "fortinet",
  "model": "FortiGate-60F",
  "version": "v7.2.5.F",
  "domain": "",
  "hostname": "fg-branch-vpn-01"
}' '{
            specs: ($specs | fromjson),
            config: {
              file: $file,
              lines: $lines,
              object: $path
            }
          }'
+ json_spec='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}'
+ site_device_map["${site}"]+='{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
'
+ IFS=
+ read -r config_file
+ printf ' { "target": "%s", "locations": { ' 203.0.113.25
+ first=true
+ jq .
++ printf '%s\n' reports
++ sort -u
+ for site in $(printf '%s\n' "${!site_device_map[@]}" | sort -u)
+ [[ -z {
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 13,
    "object": ".objects/fw3.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.14(3)",
    "domain": "edge.dc.example.com",
    "hostname": "perimeter-fw1"
  },
  "config": {
    "file": "perimeter-fw1.cfg",
    "lines": 33,
    "object": ".objects/perimeter-fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 16,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
 ]]
+ true
+ first=false
+ printf ' "%s": { "devices": ' reports
+ print '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 13,
    "object": ".objects/fw3.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.14(3)",
    "domain": "edge.dc.example.com",
    "hostname": "perimeter-fw1"
  },
  "config": {
    "file": "perimeter-fw1.cfg",
    "lines": 33,
    "object": ".objects/perimeter-fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 16,
    "object": ".objects/dmz-fw2-backup.list"
+ jq -s .
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
'
+ [[ -n {
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 13,
    "object": ".objects/fw3.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.14(3)",
    "domain": "edge.dc.example.com",
    "hostname": "perimeter-fw1"
  },
  "config": {
    "file": "perimeter-fw1.cfg",
    "lines": 33,
    "object": ".objects/perimeter-fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 16,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
 ]]
+ echo -en '{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw3.cfg",
    "lines": 13,
    "object": ".objects/fw3.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "",
    "version": "",
    "domain": "",
    "hostname": ""
  },
  "config": {
    "file": "fw1.cfg",
    "lines": 17,
    "object": ".objects/fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.14(3)",
    "domain": "edge.dc.example.com",
    "hostname": "perimeter-fw1"
  },
  "config": {
    "file": "perimeter-fw1.cfg",
    "lines": 33,
    "object": ".objects/perimeter-fw1.list"
  }
}
{
  "specs": {
    "vendor": "cisco",
    "model": "ASA",
    "version": "9.12(4)",
    "domain": "global.dmz.example.net",
    "hostname": "dmz-fw2-backup"
  },
  "config": {
    "file": "dmz-fw2-backup.cfg",
    "lines": 16,
    "object": ".objects/dmz-fw2-backup.list"
  }
}
{
  "specs": {
    "vendor": "fortinet",
    "model": "FortiGate-60F",
    "version": "v7.2.5.F",
    "domain": "",
    "hostname": "fg-branch-vpn-01"
  },
  "config": {
    "file": "fg-branch-vpn-01.cfg",
    "lines": 19,
    "object": ".objects/fg-branch-vpn-01.list"
  }
}
'
+ printf ' } '
+ printf ' } } '
+ return 0
